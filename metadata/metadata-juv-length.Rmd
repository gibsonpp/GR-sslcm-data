---
title: "Metadata for juvenile length statistics"
author: "Polly Gibson"
date: '2022-08-05'
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(knitr)
# library(kable)
library(kableExtra)
library(ggplot2)
library(dplyr)
```


## Dataset description
The juvenile length dataset provides summary statistics for all recorded length measurements of wild juvenile Chinook from brood years 1991 - 2020.  All lengths are fork length in millimeters; all lengths are at the time of tagging (or at the time of capture, for non-tagged fish). 

Length statistics are reported by population, brood year, and season (summer, fall, winter, and spring), following the structure of the reported survival estimates. 

In most seasons, not all fish captured and measured are PIT tagged. In fall and spring, at the rotary screw traps, this is primarily because we typically capture many more fish than we have tags available.  In the summer, in recent years this is primarily because some fish are too small to PIT tag: since 2011, 55mm has been the minimum length that can be tagged, but in earlier years this threshold was either set lower (or occasionally higher) or not strictly observed. Additionally, in some earlier years (BY 2000 - 2005) large numbers of fish were captured and measured/marked as part of mark-recapture population abundance estimates, creating a very large data set of length data from non-PIT  fish.  In the winter, essentially all fish captured are PIT tagged; therefore there is no length data for non-PIT tagged fish (hereafter abbreviated as **NPT**) in winter.

Because in some circumstances we may want statistics for PIT tagged fish only, while in other circumstances we want statistics for the full population, this data set reports both sets of statistics for each population/brood year/season (with a few exceptions).

At this time (August 2022) length statistics have been re-compiled only for summer and winter tag groups; length statistics for fall and spring will come later. 


## Source data 
These statistics summarize all available recorded length data from fish that meet the following conditions: 

- Fish was captured above the rotary screw trap (or at it, for fall and spring fish); exclude any fish captured below the traps.

- Fish was a unmarked at the time of the length measurement; exclude all recaptures. 

- Fish was not recorded as precocious or fry/young of year (i.e., a younger cohort than the target age class in a given year).

- Fish was not captured as part of parr collection for captive broodstock (occurred only in CAT and LOS, for brood years 1994 and 1995). 


## Fields
```{r length_fields_tbl}

juv_length_fields_tbl <- data.frame(
  Field = c("fish_subset", "population", "brood_year",	"mig_year",	"season",	
            "n_length",	"n_pit",	"n_npt",	
            "len_mean",	"len_sd",	"len_min",	"len_max",	
            "jday_med",	"rkm_mean"),
  Description = c(
    "Indicates whether the statistics in the record describe all measured fish (**`all`**) vs. only the PIT tagged fish (**`PIT`**). With a few exceptions (Lostine summer brood years 1997 and 1998), both sets of statistics (i.e., two rows of data) are provided for each population/year/season combination. Note that for winter season, `PIT` and `all` statistics are the same; in winter very few fish are ever measured without being PIT tagged, and it is extremely rare to get fish that are too small to tag during this season.",
    "`CAT` = Catherine Creek; `LOS` = Lostine River; `MIN` = Minam River; `UGR` = Upper Grande Ronde River.", 
    "Calendar year when the cohort of fish was spawned.",
    "Calendar year when the cohort of fish migrated out to the ocean; equivalent to `[brood_year] + 2`.",
    "Describes both the season when the fish were captured/tagged, and the method by which the fish were captured. `summer` and `winter` fish are actively captured by snorkel-herding throughout the rearing habitat, while `fall` and `spring` fish are passively captured in rotary screw traps.",
    "Number of length values included in the reported statistics. Equivalent to `[n_pit] + [n_npt]`.",
    "A subset of `[n_length]`: number of PIT-tagged fish included in the reported length statistics. When `[fish_subset] = PIT`, `[n_pit]` is equal to `[n_npt]`.",
    "A subset of `[n_length]`: number of **not PIT-tagged** fish included in the reported length statistics.",
    "Mean length",
    "Standard deviation of length values",
    "Minimum recorded length",
    "Maximum recorded length",
    "Median Julian day (i.e., day of year; January 1 is Julian day 1, December 31 is Julian day 365 (or 366 in leap years)) when fish were tagged.  Note that Julian day is a strong predictor of population average size for summer tagging - see below.",
    "Average river kilometer from which fish were captured. For each measured fish, river kilometer where the fish was captured is recorded. River kilometers start at the mouth and count upstream, so higher numbers indicate higher position in the watershed. This metric provides an indicator of where in the watershed most fish were captured in a given year, because average fish size is partly a function of watershed position."
  )
)

kable(juv_length_fields_tbl) %>%
  kable_styling(full_width = T, font_size = 9) %>%
  column_spec(1, bold = T, border_right = T) %>%
  column_spec(2) #, width = "30em"

# source: http://haozhu233.github.io/kableExtra/awesome_table_in_html.html#column__row_specification
```


## Notes and limitations

- Recorded length data from undersize and other non-tagged fish (NPT) from summers prior to 2001 was sparse, inconsistent, and difficult to track down.  For brood years 1991 and 1996 - 1999 I never did  manage to find any recorded length data for summer NPT fish, and it is unclear to what extent this is because there simply were no undersize fish, vs these lengths were never recorded.  But examining length distributions from the years without NPT data shows that most distributions look appropriate, indicating that the available PIT tag length data is an acceptable measure of average population size for those sampling events; the exceptions are Lostine summer fish from brood years 1997 and (especially) 1998, where the distributions show a truncation at the 55mm tagging cutoff, indicating that the PIT tag length data is missing the smaller fish in the population. Therefore Lostine summer brood years 1997 and 1998 are excluded from the `[fish_subset] = "all"` records. 
- In a few cases in the summer data, individual lengths were recorded only for the first ~20 undersize fish, and thereafter undersize fish were only tallied.  In order to make use of these data, I simulated actual lengths for these tallied undersize fish records by sampling from the data set of measured undersize lengths from a given population and year, limited to fish captured within a few rkm of the tallied fish.

- Although the timing of summer fish capture and tagging has largely remained consistent within populations over the past ~15 years, in earlier years the timing was more variable; in general, summer tagging in 1993 through ~2005 tended to happen considerably later in the year than when we now try to tag fish.  Because fish generally are growing fast during the summer, note that the median date of tagging (`[jday_med]`) is a strong predictor of population mean length:
```{r, eval=FALSE}
# NEED RELATIVE PATH TO /bio/ WITHIN GR-sslcm-data
# len.stats <- readRDS("H:/RProjects/LifeCycleModeling/LCM_DataPrep/output/juv-length-stats-snorkel.RData")

ggplot(data = filter(len.stats, season=="summer", fish_subset=="all")) +
  geom_point(aes(x=jday_med, y=len_mean, color=mig_year) ) +
  facet_wrap(~population) +
  xlab("Median day of tagging (day of year)") +
  ylab("Population mean length") +
  ggtitle("Summer mean size vs. timing of tagging")

```

- Fish mean size at summer tagging also depends on watershed position (upstream reaches vs downstream reaches), although it explains less of the variaion in population mean size than day of tagging does. Fish in higher reaches tend to emerge later, and for a given date fish from the upper watershed tend to be substantially smaller than fish from the lower watershed. 

```{r, eval=FALSE}
ggplot(data = filter(len.stats, season=="summer", fish_subset=="all")) +
  geom_point(aes(x=rkm_mean, y=len_mean, color=mig_year) ) +
  facet_wrap(~population, scales="free_x") +
  xlab("Mean river kilometer where fish were captured") +
  ylab("Population mean length") +
  ggtitle("Summer mean size vs. watershed position")
```

